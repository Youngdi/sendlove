<!DOCTYPE html>
<html>

<head>
    <title>派達心</title>
    <meta charset="utf-8" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
    <script type="text/javascript" src="youtube.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="Html5Video.js"></script>
    <script type="text/javascript" src="function.js"></script>
    <script src="jqm/jquery-2.1.1.min.js"></script>
    <script src="jqm/jquery.mobile-1.4.5.min.js"></script>
    <script src="lib/sweet-alert.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script>
    <script src="http://malsup.github.com/jquery.form.js"></script>
    <script type="text/javascript" src="js/exitapp.js"></script>
    <link rel="stylesheet" href="jqm/jquery.mobile-1.4.5.min.css" />
    <link rel="stylesheet" type="text/css" href="lib/sweet-alert.css">
</head>

<body>
    <div data-role="page" id="page1" data-theme="" style="background-image:url(pic/BG_pleft.png); background-repeat:no-repeat; background-size:100% 100%;">
        <div data-role="header" data-position="fixed" style="background-image:url(pic/header_new01.png); background-repeat:no-repeat; background-size:100% 100%; height:60px;border:transparent;">
            <h1>&nbsp;</h1>
            <a href="#" style="border:transparent;background-image:url(pic/header_left.png); background-repeat:no-repeat; background-size:100% 100%; height:24px; width:18px;">&nbsp;</a>
            <a href="user_data.html" rel="external" style="border:transparent;background-image:url(pic/header_right.png); background-repeat:no-repeat; background-size:100% 100%; height:24px; width:18px">&nbsp;</a>
        </div>
        <div data-role="main" class="ui-content">
            <ul data-role='listview' data-inset="true" data-theme="a">
                <li>
                    <a href="#page2">
                        <img src="logo/logo1.png" width="80">
                        <H1 style="color:black;">生態綠</H1>
                    </a>
                </li>
                <!--<li>
                    <a href="#page2"><img src="logo/logo2.png"  width="80">
                        <H1 style="color:black;">喜願共和國</H1>
                    </a>
                </li>-->
            </ul>
        </div>
        <div data-role="footer" data-position="fixed" style="border:transparent;">
            <div data-role="navbar">
                <ul>
                    <li><a href="" id="btn1" rel="external" style="background-image:url(pic/home.png); background-repeat:no-repeat; background-size:100% 100%;height:60px;border:transparent;" onClick="btn1()">&nbsp;</a>
                    </li>
                    <li><a href="" id="btn2" rel="external" style="background-image:url(pic/buy.png); background-repeat:no-repeat; background-size:100% 100%;height:60px;border:transparent;" onClick="btn2()">&nbsp;</a>
                    </li>
                    <li><a href="" id="btn3" rel="external" style="background-image:url(pic/search.png); background-repeat:no-repeat; background-size:100% 100%;height:60px;border:transparent;" onClick="btn3()">&nbsp;</a>
                    </li>
                    <li><a href="" id="btn4" rel="external" style="background-image:url(pic/gift.png); background-repeat:no-repeat; background-size:100% 100%;height:60px;border:transparent;" onClick="btn4()">&nbsp;</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ---------------------------------------page2特定店家商品區------------------------------------------------------------- -->
    <div data-role="page" id="page2" data-theme="c" style="background-image:url(pic/BG_pright.png); background-repeat:repeat-y; background-size:100% ;">
        <div data-role="header" data-position="fixed" style="background-image:url(pic/header_new01.png); background-repeat:no-repeat; background-size:100% 100%; height:60px;border:transparent;">
            <h1>&nbsp;</h1>
            <a href="#" style="border:transparent;background-image:url(pic/header_left.png); background-repeat:no-repeat; background-size:100% 100%; height:24px; width:18px;">&nbsp;</a>
            <a href="user_data.html" rel="external" style="border:transparent;background-image:url(pic/header_right.png); background-repeat:no-repeat; background-size:100% 100%; height:24px; width:18px">&nbsp;</a>
        </div>
        <div data-role="main" class="ui-content">
            <ul data-role='listview' data-inset="true" data-theme="a" id="cart_list">
                <!-- 放商品區 -->
            </ul>
            <button id="checkout" onclick="rightbuy();" data-theme="a" style="background:#FFFFFF;">確定結帳</button>
        </div>

        <div data-role="footer" data-position="fixed" style="border:transparent;">
            <a data-rel="back" style=" position:absolute; bottom:60px; left:0px ;border:transparent;"><img src="pic/rmove.png" width="50px" />
            </a>
            <div data-role="navbar">
                <ul>
                    <li><a href="" id="btn1" rel="external" style="background-image:url(pic/home.png); background-repeat:no-repeat; background-size:100% 100%;height:60px;border:transparent;" onClick="btn1()">&nbsp;</a>
                    </li>
                    <li><a href="" id="btn2" rel="external" style="background-image:url(pic/buy.png); background-repeat:no-repeat; background-size:100% 100%;height:60px;border:transparent;" onClick="btn2()">&nbsp;</a>
                    </li>
                    <li><a href="" id="btn3" rel="external" style="background-image:url(pic/search.png); background-repeat:no-repeat; background-size:100% 100%;height:60px;border:transparent;" onClick="btn3()">&nbsp;</a>
                    </li>
                    <li><a href="" id="btn4" rel="external" style="background-image:url(pic/gift.png); background-repeat:no-repeat; background-size:100% 100%;height:60px;border:transparent;" onClick="btn4()">&nbsp;</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ---------------------------------------page3填寫表單購買------------------------------------------------------------- -->
    <div data-role="page" id="page3" data-theme="c" style="background-image:url(pic/BG_pright.png); background-repeat:repeat-y; background-size:100% ;">
        <div data-role="header" data-position="fixed" style="background-image:url(pic/header_new01.png); background-repeat:no-repeat; background-size:100% 100%; height:60px;border:transparent;">
            <h1>&nbsp;</h1>
            <a href="#" style="border:transparent;background-image:url(pic/header_left.png); background-repeat:no-repeat; background-size:100% 100%; height:24px; width:18px;">&nbsp;</a>
            <a href="user_data.html" rel="external" style="border:transparent;background-image:url(pic/header_right.png); background-repeat:no-repeat; background-size:100% 100%; height:24px; width:18px">&nbsp;</a>
        </div>
        <div data-role="main" class="ui-content">
            <div>
                <h3>訂單填寫</h3>
                <label for="usrnm">姓名：</label>
                <input type="text" name="user" id="usrnm" placeholder="王小明" data-theme="a">
                <label for="usrnm">電話：</label>
                <input type="text" name="user" id="usrnm" placeholder="0987654321" data-theme="a">
                <label for="usrnm">寄送地址：</label>
                <input type="text" name="user" id="usrnm" placeholder="台北市信義區" data-theme="a">
                <label for="usrnm">信箱：</label>
                <input type="text" name="user" id="usrnm" placeholder="a123@yahoo.com.tw" data-theme="a">
            </div>
            <br/>
            <button onclick="rightbuy2()" data-theme="a" style="background:#FFFFFF;">確定結帳</button>
        </div>
        <div data-role="footer" data-position="fixed" style="border:transparent;">
            <a data-rel="back" style=" position:absolute; bottom:60px; left:0px ;border:transparent;"><img src="pic/rmove.png" width="50px" />
            </a>
            <div data-role="navbar">
                <ul>
                    <li><a href="" id="btn1" rel="external" style="background-image:url(pic/home.png); background-repeat:no-repeat; background-size:100% 100%;height:60px;border:transparent;" onClick="btn1()">&nbsp;</a>
                    </li>
                    <li><a href="" id="btn2" rel="external" style="background-image:url(pic/buy.png); background-repeat:no-repeat; background-size:100% 100%;height:60px;border:transparent;" onClick="btn2()">&nbsp;</a>
                    </li>
                    <li><a href="" id="btn3" rel="external" style="background-image:url(pic/search.png); background-repeat:no-repeat; background-size:100% 100%;height:60px;border:transparent;" onClick="btn3()">&nbsp;</a>
                    </li>
                    <li><a href="" id="btn4" rel="external" style="background-image:url(pic/gift.png); background-repeat:no-repeat; background-size:100% 100%;height:60px;border:transparent;" onClick="btn4()">&nbsp;</a>
                    </li>
                </ul>
            </div>
        </div>
        <script>
        $('#cart_list').empty();
        $.ajax({
                 // http://youngdi.byethost18.com/php_function/sendlove/
                url: 'http://youngdi.byethost18.com/php_function/sendlove/cart.php',
                // url: 'cart.php',
            })
            .done(function(data) {
                $('#cart_list').empty();
                if (data.length == 29) {
                    $('#cart_list').append(data);
                    $('#checkout').remove();
                } else {
                    var json_string = data;
                    var result = JSON.parse(json_string);
                    var count = 0;
                    $.each(result.item, function(i, item) {
                        // <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
                        count = i;
                        $('#cart_list').append('<li id="A' + item.id + '"><img id="money" money="' + result.total_price + '" src="commodity/' + item.img + '" width="80px" style="margin-top:50px;"/><H1 style="color:#222222;">' + item.name + '</H1><h2 style="color:red;">特價$' + item.price + '</h2><span>可購買</span><center><select id="zone' + item.id + '" data-native-menu="false" data-theme="a"></select><form id="remove_form" name="form" method="GET" action="http://youngdi.byethost18.com/php_function/sendlove/remove_from_cart.php"><input type="hidden" name="id" value="' + item.id + '"/><button>刪除</button></form></center></li>');
                        for (i = 0; i < item.quantity + 1; i++) {
                            var s = document.getElementById('zone' + item.id + '');
                            var new_option = new Option(i, item.name);
                            s.options.add(new_option);
                        }
                    });
                    $('#remove_form').ajaxForm(function(data) {
                        // alert(data); //判斷用的
                        if (count === 0) {
                            // alert(count);
                            $('#checkout').remove();
                            $('#A' + data + '').remove();
                            $('#cart_list').append('<center>沒有商品在你的購物籃喔！</center>');
                        } else {
                            count = count - 1;
                            // alert(count);
                            $('#A' + data + '').remove();
                        }
                    });
                }
            });

        function rightbuy() {
            $.ajax({
                    url: 'http://youngdi.byethost18.com/php_function/sendlove/cart.php',
                    // url: 'cart.php',
                    type: 'GET',
                    dataType: 'json',
                })
                .done(function(data) {
                    console.log(data.total_price);
                    total_price = data.total_price;
                    swal({
                        title: "確定購買?",
                        text: '金額總共:' + total_price + '$',
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "確定",
                        cancelButtonText: "取消",
                        closeOnConfirm: false
                    }, function() {
                        window.location.href = "buy_list.html#page3";
                    });
                });
        }

        function rightbuy2() {
            swal({
                title: "確定結帳?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "確定",
                cancelButtonText: "取消",
                closeOnConfirm: false
            }, function() {
                YoutubeVideoPlayer.openVideo('q3trvWJxndM');
                window.location.href = "home.html";
            });
        }
        </script>
</body>

</html>
